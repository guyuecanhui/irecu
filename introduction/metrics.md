# 推荐系统评测

推荐系统包括三个参与方：用户、物品提供者和推荐系统。一个好的推荐系统首先要满足用户需求，给用户推荐优质物品，同时需要推荐范围尽量覆盖所有物品提供者的物品，最后自身还能够收集足够多的反馈信息，不断完善提高推荐的质量。

---

## 一、实验方法

一个新的推荐算法最终上线，一般需要完成以下三个步骤：

1. 通过离线实验证明它在很多离线指标上优于现有算法；
2. 通过用户调查确定它的用户满意度不低于现有的算法；
3. 通过在线AB测试确定它在我们关心的指标上优于现有的算法。

### 1.1、离线实验

通过日志/Trace系统收集用户行为数据，生成标准数据集，在这个数据集上进行训练和测试。这种方式不需要实际用户参与，不需要对实际系统进行控制，评测速度快，可以大量测试。但是无法计算商业上关注的指标，如点击率、转化率等。

### 1.2、用户调查

根据实际用户分布选择一些真实用户在测试的推荐系统上完成一些任务，在完成任务时记录他们的行为，并让他们回答一些问题，通过分析他们的行为和答案来了解推荐系统的性能。用户调查可以获取用户的主观感受指标，并且相对于在线实验风险低；但是用户调查成本较高，需要控制调查数量的同时，保证结果的统计意义。

### 1.3、在线实验

根据规则将用户随机分成若干组，对每一组用户应用不同的推荐算法，统计这些用户组的点击率、转换率等商业指标。AB测试成本高、风险大，主要针对离线实验和用户调查中表现较好的算法进行。


## 二、评价指标

### 2.1、预测准确度

预测准确度是最重要的离线评测指标，它是度量一个推荐系统或推荐算法预测用户行为的能力。根据研究方向的不同，预测准确度的具体指标也不同。

#### A、 评分预测准确度

该指标是衡量推荐算法预测的评分和用户实际评分的相近程度。推荐系统通过收集用户对物品的历史的评分数据建立兴趣模型，从而预测用户对将来看到的一个没有评过分的物品时会给这个物品多少分。评分预测准确度一般通过均方差（RMSE）和平均绝对误差（MAE）计算。

$$
RMSE=\sqrt{\frac{\sum_{u,i\in T}(r_{ui}-\hat{r_{ui}})^2}{\mid T\mid}}, \ \ MAE=\frac{\sum_{u,i\in T}\mid r_{ui} - \hat{r_{ui}}\mid}{\mid T\mid}
$$

$$u,i$$ 分别表示测试集中的一个用户和物品，$$r_{ui}$$ 表示用户 $$u$$ 对物品 $$i$$ 的实际评分，$$\hat{r_{ui}}$$ 是推荐系统给的评分。

#### B、分类准确度

分类准确度指标衡量的是推荐系统能够正确预测用户喜欢或者不喜欢某个商品的能力。这个指标常被用来做TopN推荐，即网站给用户提供服务时一般是给用户一个个性化列表，这种推荐叫做TopN推荐。度量分类准确度最常用的指标有准确率（Precision）和召回率（Recall）。

$$
Precision=\frac{\sum_{u\in U}\mid R(u) \cap T(u)\mid}{\sum_{u\in U}\mid R(u) \mid}, \ \ Recall=\frac{\sum_{u\in U}\mid R(u) \cap T(u)\mid}{\sum_{u\in U}\mid T(u) \mid}
$$

$$R(u)$$ 是根据用户在训练集上的行为给用户作出的推荐列表，而 $$T(u)$$ 是用户在测试集上的行为列表。

#### C、排序准确度

排序准确度指标度量推荐算法得到的有序推荐列表和用户对商品排序的统一程度。如在比较两个推荐算法的时候，两个算法在推荐的5个商品中都有1个是用户感兴趣的，于是他们的推荐精确性都为0.2。但是算法A将用户喜欢的商品排在第1位，而算法B将用户喜欢的商品排在第5位，显然算法A更优越。可以使用平均排序分(average rank score)来度量推荐系统的排序准确度。对于某一用户 $$u$$ 来说，商品 $$\alpha$$ 的排序分定义如下：

$$
RS_{u\cdot \alpha}=\frac{l{u\cdot \alpha}}{L_u}
$$

$$L_u$$ 等于用户$$u$$未选择过的商品数目，$$l{u\cdot \alpha}$$ 为待预测商品 $$\alpha$$ 在用户 $$u$$ 的推荐列表中的排名。举例来说，如果有1 000部影片是用户 $$u$$ 没有选择过的，其中用户喜欢的电影《金陵十三钗》出现在用户 $$u$$ 推荐列表的第10位，那么对于用户 $$u$$ 而言电影《金陵十三钗》的排序分为 $$RS_{u\cdot \alpha}=\frac{10}{1000}=0.01$$。将所有用户的排序分求平均即得到系统的排序分 $$RS$$。排序分值越小，说明系统越趋向于把用户喜欢的商品排在前面。反之，则说明系统把用户喜欢的商品排在了后面。

### 2.2、用户满意度

用户作为推荐系统的参与者，其满意度是评测推荐系统最重要的指标之一。一般用户满意度通过用户调查或在线实验获得。在一定程度上，我们可以根据用户的购买率、点击率、用户停留时间、下载等指标度量用户的满意度。

### 2.3、覆盖率（coverage）

覆盖率是指一个推荐系统向所有用户推荐的物品占所有物品的比例。同时该指标也描述了一个推荐系统对物品长尾的发掘能力。简单的覆盖率计算公式如下：

$$
Coverage=\frac{\mid \cup_{u\in U} R(u) \mid}{\mid I \mid}
$$

$$U$$ 为系统的用户集合，$$R(u)$$ 为推荐系统给每个用户推荐一个长度为 $$N$$ 的物品列表，$$I$$ 为物品全集。推荐系统的初衷是消除马太效应，但是实际上很多推荐系统 会产生马太效应。为了判断一个推荐算法是否产生了马太效应，可以计算算法的基尼系数：

$$
G=\frac{1}{n-1}\sum_{j=1}^n(2j-n-1)p(i_j)
$$

其中，$$i_j$$ 是按物品流行度 $$p()$$ 从小到大排序的物品列表中第 $$j$$ 个物品。若应用算法后的基尼系数大于初始情况，说明算法具有马太效应。

### 2.4、多样性

在实际应用中，即使一个准确率很高的推荐系统，也很难保证能够满足用户的广泛的兴趣。一个好的推荐系统应该向用户推荐准确率高并且又有用的商品。在推荐系统中，多样性体现在以下两个层次，用户间的多样性(inter-user diversity)，衡量推荐系统对不同用户推荐不同商品的能力；另一个是用户内的多样性(intra-user diversity)，衡量推荐系统对一个用户推荐商品的多样性。对于用户$$u$$ 和$$t$$ ，可以用汉明距离(hamming distance)来衡量这两个用户推荐列表的不同程度，具体定义为：

$$
H{ut}(L)=1-\frac{Q{ut}(L)}{L}
$$

$$Q{ut}(L)$$ 表示用户 $$u$$ 和 $$t$$ 推荐列表中相同商品的个数。如果两个推荐列表是完全一致的，那么 $$H{ut}(L)=0$$，反之如果两个推荐列表没有任何重叠的商品则 $$H_{ut}(L)=1$$。所有的用户对的汉明距离的平均值即是整个系统的汉明距离 $$H(L)$$。
用户内的多样性(intra-user diversity)可以用如下定义：

$$
Iu(L)=\frac{1}{L(L-1)}\sum_{\alpha \neq \beta}s(\alpha,\beta)
$$

$$s(\alpha,\beta)$$ 表示商品 $$\alpha$$ 和 $$\beta$$ 的相似度，系统的Intra-user diversity即是所有用户的平均值。$$I_u$$ 越小，表明系统为用户推荐的商品的多样性越高，系统的多样性也就越大。

### 2.5、其他指标

新颖性、惊喜度、信任度、实时性、健壮性、商业目标等。